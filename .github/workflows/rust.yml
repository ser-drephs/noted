name: Rust

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

env:
  CARGO_TERM_COLOR: always

jobs:
  build:

    runs-on: ubuntu-latest
    # runs-on: debian-rust

    steps:
    # - name: install software
    #   run: sudo apt-get update && sudo apt-get install -y mingw-w64 --no-install-recommends
    # - name: install rustup
    #   run: curl https://sh.rustup.rs -sSf | sh -s -- -y
    # - name: add windows target
    #   run: rustup target add x86_64-pc-windows-gnu
    - name: checkout
      uses: actions/checkout@v3
      # with:
      #   fetch-depth: 0
    - name: âœ… check package
      run: cargo check --lib
    # - name: ðŸ§± build
    #   run: cargo build
    - name: ðŸ§ª run tests
      run: cargo test
    - name: Semantic Release
      id: semantic-version
      uses: cycjimmy/semantic-release-action@v2
      with:
        semantic_version: 18
        dry_run: true
        extra_plugins: |
          @semantic-release/changelog@6
          @semantic-release/git@10
          @semantic-release/github@8
          @semantic-release/commit-analyzer@9
          conventional-changelog-conventionalcommits@4
      env:
        DEBUG: semantic-release:*
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    # - name: Do something when a new release published
    #   run: |
    #     echo Version: ${{ steps.semantic-version.outputs.new_release_version }}
    #     echo Changed: ${{ steps.semantic-version.outputs.new_release_published }}
    # - name: Chocolatey Action
    #   uses: crazy-max/ghaction-chocolatey@v1.6.0
    #   if: ${{ steps.semantic-version.outputs.new_release_published }} == true
    #   with:
    #     args: -h